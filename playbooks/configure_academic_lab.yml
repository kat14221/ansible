---
# Playbook: Configuraci√≥n Completa del Laboratorio Acad√©mico
# Descripci√≥n: Configura DHCPv6 con IPs cortas, usuarios acad√©micos y red P2P.

- name: Configurar Debian Router como Gateway IPv6
  hosts: debian_router
  become: yes
  gather_facts: yes
  
  tasks:
    - name: Aplicar rol de configuraci√≥n del router
      include_role:
        name: debian-ipv6-router
      tags: gateway

    - name: Incluir rol para crear usuarios acad√©micos
      include_role:
        name: academic-users
      tags: users

- name: Configurar Cliente Ubuntu
  hosts: ubuntu-pc
  become: yes
  gather_facts: yes
  tasks:
    - name: Deshabilitar SLAAC en Ubuntu
      sysctl:
        name: "{{ item }}"
        value: '0'
        state: present
        reload: yes
      loop:
        - net.ipv6.conf.all.autoconf
        - net.ipv6.conf.default.autoconf
      tags: client

    - name: Configurar netplan para DHCPv6 puro
      copy:
        dest: /etc/netplan/01-netcfg.yaml
        content: |
          network: 
            version: 2
            renderer: networkd
            ethernets:
              ens192:
                dhcp6: yes
                ipv6-privacy: no
                accept-ra: yes
        mode: '0644'
      notify: apply netplan
      tags: client

    - name: Crear usuarios acad√©micos en cliente
      include_role:
        name: academic-users
      tags: users

  handlers:
    - name: apply netplan
      command: netplan apply
      become: yes

- name: Resumen de Configuraci√≥n
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Mostrar resumen completo
      debug:
        msg:
          - "=========================================="
          - "‚úÖ LABORATORIO ACAD√âMICO CONFIGURADO"
          - "=========================================="
          - ""
          - "üåê RED:"
          - "   Red Fernandez: 2025:db8:101::/64"
          - "   Gateway: 2025:db8:101::1 (debian-router)"
          - ""
          - "üìç DHCPv6 - IPs Cortas:"
          - "   Rango: ::10 a ::99"
          - "   ubuntu-pc: 2025:db8:101::10"
          - "   windows-pc: 2025:db8:101::11"
          - ""
          - "üë• USUARIOS ACAD√âMICOS:"
          - "   Alumnos: alumno1, alumno2, alumno3 (pass: alumno123)"
          - "   Profesores: profesor1, profesor2 (pass: profesor123)"
          - "   Admin: admin (pass: admin123)"
          - ""
          - "üéÆ JUEGOS P2P:"
          - "   Cualquier alumno puede crear una partida local."
          - "   Otros pueden unirse usando la IP del anfitri√≥n."
          - ""
          - "üìä ACCESOS:"
          - "   SSH debian-router: ssh admin@2025:db8:101::1"
          - "   SSH ubuntu-pc: ssh alumno1@2025:db8:101::10"
          - "   Network Monitor: http://[2025:db8:101::1]:5000"
          - ""
          - "üîí SEGURIDAD:"
          - "   ‚úÖ Firewall P2P entre redes de laboratorio"
          - "   ‚úÖ Usuarios con permisos limitados"
          - "   ‚úÖ SLAAC deshabilitado (solo DHCPv6)"
          - "=========================================="
