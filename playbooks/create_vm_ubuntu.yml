---
# Crear VM Ubuntu PC en ESXi

- name: Crear VM Ubuntu PC
  hosts: esxi
  gather_facts: no
  tasks:
    - name: Crear VM Ubuntu PC
      community.vmware.vmware_guest:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        validate_certs: no
        datacenter: ha-datacenter
        folder: /vm
        name: vm-ubuntu-pc
        state: present
        guest_id: ubuntu64Guest
        disk:
          - size_gb: 25
            type: thin
            datastore: datastore1
        hardware:
          memory_mb: 4096
          num_cpus: 2
          scsi: paravirtual
        networks:
          - name: Red Fernandez
            device_type: vmxnet3
        cdrom:
          - controller_number: 0
            unit_number: 0
            state: present
            type: iso
            iso_path: "[datastore1] ubuntu/ubuntu-24.04.2-desktop-amd64.iso"
        wait_for_ip_address: no
      register: vm_result

    - name: Mostrar resultado
      debug:
        msg:
          - "=========================================="
          - "✅ VM Ubuntu PC creada"
          - "Nombre: vm-ubuntu-pc"
          - "Estado: {{ vm_result.instance.hw_power_state }}"
          - ""
          - "SIGUIENTE PASO:"
          - "1. Acceder a ESXi: https://172.17.25.1"
          - "2. Instalar Ubuntu 24.04 en vm-ubuntu-pc"
          - "3. Configurar usuario ansible"
          - "=========================================="