---
# Playbook: Captura de Tráfico IPv6
# Descripción: tcpdump para análisis de red
# Evidencias: /tmp/*.pcap

- name: Captura de Tráfico IPv6
  hosts: debian-router
  become: yes
  gather_facts: yes
  tasks:
    - name: Instalar tcpdump
      apt:
        name: tcpdump
        state: present
        update_cache: yes

    - name: Capturar tráfico IPv6 en interfaz LAN
      shell: |
        timeout 30 tcpdump -i ens34 -w /tmp/captura_ipv6_$(date +%Y%m%d_%H%M%S).pcap ip6 &
      async: 35
      poll: 0
      register: capture_job

    - name: Mostrar información de captura
      debug:
        msg:
          - "================================================"
          - "  Captura de Tráfico Iniciada"
          - "================================================"
          - "Interfaz: ens34 (LAN)"
          - "Filtro: IPv6"
          - "Duración: 30 segundos"
          - "Archivo: /tmp/captura_ipv6_*.pcap"
          - ""
          - "Para descargar:"
          - "  scp ansible@172.17.25.122:/tmp/captura_ipv6_*.pcap ~/"
          - ""
          - "Para analizar con Wireshark:"
          - "  wireshark ~/captura_ipv6_*.pcap"
          - "================================================"
