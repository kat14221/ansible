---
# Playbook: Bootstrap Completo Automatizado
# Descripci√≥n: Automatiza la creaci√≥n de VMs usando roles existentes

- name: Crear VM Debian Router
  hosts: esxi
  gather_facts: no
  tasks:
    - name: Crear VM Router Debian
      include_role:
        name: vmware-router
      when: inventory_hostname == "esxi-vmware-host"

- name: Crear VMs de Usuario
  hosts: vm_hosts
  gather_facts: no
  tasks:
    - name: Crear VM Ubuntu PC
      include_role:
        name: vmware-ubuntu
      when: inventory_hostname == "ubuntu-pc"
      delegate_to: esxi-vmware-host

    - name: Crear VM Windows PC
      include_role:
        name: vmware-windows
      when: inventory_hostname == "windows-pc"
      delegate_to: esxi-vmware-host

- name: Mostrar Resumen de Creaci√≥n
  hosts: localhost
  gather_facts: no
  tasks:

    - name: Mostrar instrucciones post-creaci√≥n
      debug:
        msg:
          - "=========================================="
          - "‚úÖ VMs creadas exitosamente"
          - ""
          - "PASOS MANUALES REQUERIDOS:"
          - ""
          - "1. üñ•Ô∏è Instalar OS en cada VM:"
          - "   ‚Ä¢ vm-debian-router: Debian 12"
          - "   ‚Ä¢ vm-ubuntu-pc: Ubuntu 24.04"
          - "   ‚Ä¢ vm-windows-pc: Windows 11"
          - ""
          - "2. üë§ Crear usuario 'ansible' en Linux VMs:"
          - "   sudo adduser ansible"
          - "   sudo usermod -aG sudo ansible"
          - "   echo 'ansible ALL=(ALL) NOPASSWD: ALL' | sudo tee /etc/sudoers.d/ansible"
          - ""
          - "3. üîë Copiar SSH key:"
          - "   ssh-copy-id ansible@<VM-IP>"
          - ""
          - "4. üöÄ Ejecutar configuraci√≥n:"
          - "   ansible-playbook playbooks/site.yml"
          - "=========================================="