---
# Playbook simplificado para crear VMs - Sin verificaciones problemÃ¡ticas
# Uso: ansible-playbook playbooks/create_vms_simple.yml -vvv

- name: Crear VM Debian Router
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Crear/Encender VM Debian Router
      community.vmware.vmware_guest:
        hostname: "172.17.25.1"
        username: "root"
        password: "qwe123$"
        validate_certs: no
        datacenter: ha-datacenter
        folder: /vm
        name: vm-debian-router
        state: poweredon
        guest_id: debian11_64Guest
        disk:
          - size_gb: 20
            type: thin
            datastore: datastore1
        hardware:
          memory_mb: 2048
          num_cpus: 2
          scsi: paravirtual
        networks:
          - name: VM Network
            device_type: vmxnet3
          - name: Red Fernandez
            device_type: vmxnet3
        cdrom:
          - controller_number: 0
            unit_number: 0
            state: present
            type: iso
            iso_path: "[datastore1] debian/debian-12.12.0-amd64-netinst.iso"
        wait_for_ip_address: no
        force: yes
      register: router_result
      ignore_errors: yes

    - name: Resultado VM Router
      debug:
        msg:
          - "âœ… VM Debian Router procesada"
          - "Estado: Encendida y lista para instalaciÃ³n"
          - "ISO: debian-12.12.0-amd64-netinst.iso montada"

- name: Crear VM Ubuntu PC
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Crear/Encender VM Ubuntu PC
      community.vmware.vmware_guest:
        hostname: "172.17.25.1"
        username: "root"
        password: "qwe123$"
        validate_certs: no 
       datacenter: ha-datacenter
        folder: /vm
        name: vm-ubuntu-pc
        state: poweredon
        guest_id: ubuntu64Guest
        disk:
          - size_gb: 25
            type: thin
            datastore: datastore1
        hardware:
          memory_mb: 4096
          num_cpus: 2
          scsi: paravirtual
        networks:
          - name: Red Fernandez
            device_type: vmxnet3
        cdrom:
          - controller_number: 0
            unit_number: 0
            state: present
            type: iso
            iso_path: "[datastore1] ubuntu/ubuntu-24.04.2-desktop-amd64.iso"
        wait_for_ip_address: no
        force: yes
      register: ubuntu_result
      ignore_errors: yes

    - name: Resultado VM Ubuntu
      debug:
        msg:
          - "âœ… VM Ubuntu PC procesada"
          - "Estado: Encendida y lista para instalaciÃ³n"

- name: Crear VM Windows PC
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Crear/Encender VM Windows PC
      community.vmware.vmware_guest:
        hostname: "172.17.25.1"
        username: "root"
        password: "qwe123$"
        validate_certs: no
        datacenter: ha-datacenter
        folder: /vm
        name: vm-windows-pc
        state: poweredon
        guest_id: windows11_64Guest
        disk:
          - size_gb: 40
            type: thin
            datastore: datastore1
        hardware:
          memory_mb: 4096
          num_cpus: 2
          scsi: paravirtual
        networks:
          - name: Red Fernandez
            device_type: vmxnet3
        cdrom:
          - controller_number: 0
            unit_number: 0
            state: present
            type: iso
            iso_path: "[datastore1] W-11/Win11_24H2_Spanish_x64.iso"
        wait_for_ip_address: no
        force: yes
      register: windows_result
      ignore_errors: yes

    - name: Resultado VM Windows
      debug:
        msg:
          - "âœ… VM Windows PC procesada"
          - "Estado: Encendida y lista para instalaciÃ³n"

- name: Resumen Final
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Mostrar resumen
      debug:
        msg:
          - "================================================"
          - "ðŸŽ‰ TODAS LAS VMs PROCESADAS"
          - "================================================"
          - ""
          - "âœ… vm-debian-router: Encendida"
          - "âœ… vm-ubuntu-pc: Encendida"  
          - "âœ… vm-windows-pc: Encendida"
          - ""
          - "ðŸ“‹ PRÃ“XIMO PASO:"
          - "1. Acceder a ESXi: https://172.17.25.1/ui/"
          - "2. Instalar SOs manualmente en cada VM"
          - "3. Seguir guÃ­a: INSTALACION_VMS.md"
          - "================================================"