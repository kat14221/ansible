---
# Playbook Maestro - ConfiguraciÃ³n Completa de VMWARE-101001
# Red AcadÃ©mica IPv6 con Ansible
# Backbone: 2025:DB8:101::/64
# LAN: 2025:DB8:220::/64

- name: Configurar Dispositivos de Red (IOS)
  hosts: network_devices
  gather_facts: yes
  roles:
    - ios-basic-config
  tags:
    - ios
    - network
    - ios_config

- name: Crear VMs en ESXi
  hosts: esxi
  gather_facts: no
  tasks:
    - name: Crear VM Router Debian
      include_role:
        name: vmware-router
      when: inventory_hostname == "esxi-vmware-host"
      tags:
        - vm_creation

- name: Crear VMs de Usuario
  hosts: vm_hosts
  gather_facts: no
  tasks:
    - name: Crear VM Ubuntu PC
      include_role:
        name: vmware-ubuntu
      when: inventory_hostname == "ubuntu-pc"
      tags:
        - vm_creation
        - vm_ubuntu

    - name: Crear VM Windows PC
      include_role:
        name: vmware-windows
      when: inventory_hostname == "windows-pc"
      tags:
        - vm_creation
        - vm_windows

- name: Configurar Router Debian
  hosts: vm_router
  become: yes
  gather_facts: yes
  roles:
    - debian-ipv6-router
    - debian-services
  tags:
    - debian
    - router
    - services

- name: Tests de Conectividad
  hosts: vm_router
  become: yes
  roles:
    - connectivity-tests
  tags:
    - tests
    - connectivity

- name: Captura de TrÃ¡fico
  hosts: vm_router
  become: yes
  roles:
    - traffic-capture
  tags:
    - capture
    - traffic

- name: Aplicar Firewall Policy (Reglas AsimÃ©tricas)
  hosts: vm_router
  become: yes
  gather_facts: yes
  roles:
    - firewall-policy
  tags:
    - firewall
    - security

- name: Hardening de Seguridad SSH (Solo Linux)
  hosts: linux_servers
  become: yes
  gather_facts: yes
  roles:
    - ssh-hardening
  tags:
    - security
    - ssh

- name: Hardening General del Sistema (Solo Linux)
  hosts: linux_servers
  become: yes
  gather_facts: yes
  roles:
    - hardening
  tags:
    - security
    - hardening

- name: Recolectar Evidencias Finales
  hosts: all
  gather_facts: yes
  roles:
    - evidence-collector
  tags:
    - evidence
    - validation

- name: Generar Informes TÃ©cnicos
  hosts: all
  gather_facts: yes
  roles:
    - technical-report
  tags:
    - reports
    - technical

- name: Configurar Carpetas Compartidas (Samba)
  hosts: linux_servers
  become: yes
  gather_facts: yes
  roles:
    - shared-folders
  tags:
    - shares
    - samba

- name: Resumen Final
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Mostrar resumen de ejecuciÃ³n
      debug:
        msg:
          - "================================================"
          - "  ConfiguraciÃ³n Completa - VMWARE-101001"
          - "================================================"
          - ""
          - "âœ… Equipos IOS configurados"
          - "âœ… VMs creadas en ESXi"
          - "âœ… Router Debian configurado con IPv6"
          - "âœ… Servicios HTTP desplegados"
          - "âœ… Firewall configurado (reglas asimÃ©tricas)"
          - "âœ… Hardening de seguridad aplicado"
          - "âœ… Tests de conectividad ejecutados"
          - "âœ… Captura de trÃ¡fico completada"
          - "âœ… Evidencias recolectadas"
          - "âœ… Informes tÃ©cnicos generados"
          - "âœ… Carpetas compartidas configuradas"
          - ""
          - "ğŸ“ Evidencias guardadas en: evidence/"
          - "   - Configs: evidence/configs/"
          - "   - Tests: evidence/pings/"
          - "   - Capturas: evidence/pcaps/"
          - "   - Servicios: evidence/services/"
          - "   - Reportes: evidence/reports/"
          - "   - Informes TÃ©cnicos: evidence/technical_reports/"
          - "   - Logs: evidence/logs/"
          - ""
          - "ğŸ“Š Ver informes: evidence/technical_reports/index.html"
          - "ğŸ“ Carpetas compartidas:"
          - "   \\\\172.17.25.126\\reports (debian-router)"
          - "   \\\\2025:db8:101::10\\reports (ubuntu-pc)"
          - ""
          - "ğŸŒ Acceso HTTP: http://[2025:db8:220::1]"
          - "ğŸŒ Backbone: http://[2025:db8:101::a1]"
          - ""
          - "ğŸ”’ Firewall: 100::/64 â†’ 101::/64 âœ… | 101::/64 â†’ 100::/64 âŒ"
          - "================================================"
