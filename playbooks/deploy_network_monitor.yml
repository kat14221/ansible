---
# ğŸ“¡ Playbook: Desplegar Network Monitor en debian-router

- name: "ğŸ–¥ï¸  Desplegar Network Monitor Dashboard"
  hosts: debian-router
  become: yes
  gather_facts: yes

  vars:
    monitor_port: 5000
    monitor_path: /opt/network-monitor
    monitor_user: root

  pre_tasks:
    - name: "â„¹ï¸  Mostrar informaciÃ³n del sistema"
      debug:
        msg: |
          Sistema: {{ ansible_os_family }}
          VersiÃ³n: {{ ansible_distribution_version }}
          Python: {{ ansible_python_version }}

    - name: "ğŸ“‹ Verificar requerimientos"
      assert:
        that:
          - ansible_distribution == 'Debian'
          - ansible_python_version is version('3.8', '>=')
        fail_msg: "Requerimientos no cumplidos"

  roles:
    - role: network-monitor
      tags: ["monitor"]

  post_tasks:
    - name: "âœ… Verificar que el servicio estÃ¡ activo"
      systemd:
        name: network-monitor
        state: started
        enabled: yes

    - name: "ğŸ§ª Test de acceso al dashboard"
      uri:
        url: "http://localhost:{{ monitor_port }}/"
        status_code: 200
      retries: 5
      delay: 2
      register: monitor_test

    - name: "ğŸ“Š Mostrar informaciÃ³n de acceso"
      debug:
        msg: |
          âœ… Network Monitor instalado exitosamente!
          
          ğŸŒ Acceso Web: http://debian-router:{{ monitor_port }}
                        http://2025:db8:101::1:{{ monitor_port }}
          
          ğŸ“‹ Ver logs:
             - tail -f /var/log/network-monitor/app.log
             - journalctl -u network-monitor -f
          
          ğŸ” Red monitorizada: 2025:db8:101::/64
          ğŸ“¡ Interfaz: ens192
          
          âš¡ CaracterÃ­sticas:
             âœ“ DetecciÃ³n automÃ¡tica de dispositivos
             âœ“ ConexiÃ³n SSH integrada
             âœ“ VisualizaciÃ³n en tiempo real
             âœ“ EstadÃ­sticas de trÃ¡fico
             âœ“ ExportaciÃ³n JSON
