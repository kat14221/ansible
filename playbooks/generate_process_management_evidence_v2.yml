---
# Playbook: GeneraciÃ³n de Evidencias - GestiÃ³n de Procesos y Servicios (V2 - Corregido)
# PropÃ³sito: Demostrar competencia en control y optimizaciÃ³n de procesos
# Fecha: 2025-11-25

- name: Crear directorio local de evidencias
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Crear directorio de evidencias en mÃ¡quina local
      file:
        path: "evidence/gestion_procesos"
        state: directory
        mode: '0755'

- name: Generar Evidencias de GestiÃ³n de Procesos y Servicios
  hosts: debian_router
  become: yes
  gather_facts: yes
  
  vars:
    remote_dir: "/tmp/gestion_procesos"
    local_dir: "evidence/gestion_procesos"
  
  tasks:
    # ========================================
    # PREPARACIÃ“N
    # ========================================
    - name: Crear directorio temporal en servidor remoto
      file:
        path: "{{ remote_dir }}"
        state: directory
        mode: '0755'

    - name: Generar archivo de inicio
      shell: |
        cat > {{ remote_dir }}/00_INICIO.txt << 'EOF'
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘   EVIDENCIAS: GESTIÃ“N DE PROCESOS Y SERVICIOS                    â•‘
        â•‘   Proyecto: VMWARE-101001 - Red AcadÃ©mica IPv6                   â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        Fecha: {{ ansible_date_time.date }}
        Hora: {{ ansible_date_time.time }}
        Host: {{ inventory_hostname }}
        Sistema: {{ ansible_distribution }} {{ ansible_distribution_version }}
        Kernel: {{ ansible_kernel }}
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        OBJETIVO:
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        Demostrar competencia en:
        âœ“ GestiÃ³n de servicios con systemd
        âœ“ Monitoreo de procesos en tiempo real
        âœ“ AnÃ¡lisis de uso de recursos (CPU, Memoria)
        âœ“ Control de prioridades de procesos
        âœ“ OptimizaciÃ³n de servicios crÃ­ticos
        âœ“ ConfiguraciÃ³n de arranque automÃ¡tico
        âœ“ Troubleshooting de servicios
        
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        EOF
      args:
        executable: /bin/bash

    # ========================================
    # 1. INVENTARIO DE SERVICIOS CRÃTICOS
    # ========================================
    - name: "EVIDENCIA 1: Listar todos los servicios systemd"
      shell: |
        {
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  1. INVENTARIO COMPLETO DE SERVICIOS SYSTEMD"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "--- Todos los servicios (activos e inactivos) ---"
        systemctl list-units --type=service --all --no-pager
        echo ""
        echo "--- Resumen por estado ---"
        systemctl list-units --type=service --no-pager | tail -1
        } > {{ remote_dir }}/01_inventario_servicios.txt

    # ========================================
    # 2. ESTADO DE SERVICIOS CRÃTICOS
    # ========================================
    - name: "EVIDENCIA 2: Estado detallado de servicios crÃ­ticos"
      shell: |
        {
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  2. ESTADO DE SERVICIOS CRÃTICOS DEL LABORATORIO"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        for service in radvd isc-dhcp-server apache2 vsftpd ssh dnsmasq firewalld; do
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚  SERVICIO: $service"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
          systemctl status $service --no-pager -l 2>&1 || echo "Servicio no encontrado"
          echo ""
          echo "--- ConfiguraciÃ³n de arranque ---"
          systemctl is-enabled $service 2>/dev/null || echo "N/A"
          echo ""
          echo "--- Procesos asociados ---"
          ps aux | grep -i $service | grep -v grep || echo "No hay procesos visibles"
          echo ""
        done
        } > {{ remote_dir }}/02_servicios_criticos.txt

    # ========================================
    # 3. ANÃLISIS DE PROCESOS POR CPU
    # ========================================
    - name: "EVIDENCIA 3: Top 20 procesos por uso de CPU"
      shell: |
        {
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  3. ANÃLISIS DE PROCESOS - TOP 20 POR CPU"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        ps aux --sort=-%cpu | head -21
        echo ""
        echo "--- Load Average ---"
        uptime
        } > {{ remote_dir }}/03_top_procesos_cpu.txt

    # ========================================
    # 4. ANÃLISIS DE PROCESOS POR MEMORIA
    # ========================================
    - name: "EVIDENCIA 4: Top 20 procesos por uso de Memoria"
      shell: |
        {
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  4. ANÃLISIS DE PROCESOS - TOP 20 POR MEMORIA"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        ps aux --sort=-%mem | head -21
        echo ""
        echo "--- Resumen de memoria del sistema ---"
        free -h
        echo ""
        echo "--- Memoria por proceso (top 10) ---"
        ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem | head -11
        } > {{ remote_dir }}/04_top_procesos_memoria.txt

    # ========================================
    # 5. CONTROL DE SERVICIOS
    # ========================================
    - name: "EVIDENCIA 5: Demostrar control de servicios"
      shell: |
        {
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  5. CONTROL Y GESTIÃ“N DE SERVICIOS"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "--- Estado ANTES de reiniciar Apache2 ---"
        systemctl status apache2 --no-pager | head -15
        echo ""
        echo "--- REINICIANDO Apache2 ---"
        systemctl restart apache2
        sleep 2
        echo "âœ“ Servicio reiniciado exitosamente"
        echo ""
        echo "--- Estado DESPUÃ‰S de reiniciar Apache2 ---"
        systemctl status apache2 --no-pager | head -15
        echo ""
        echo "--- Tiempo de actividad del servicio ---"
        systemctl show apache2 --property=ActiveEnterTimestamp --no-pager
        echo ""
        echo "--- Logs recientes (Ãºltimas 10 lÃ­neas) ---"
        journalctl -u apache2 -n 10 --no-pager
        } > {{ remote_dir }}/05_control_servicios.txt

    # ========================================
    # 6. CONFIGURACIÃ“N DE ARRANQUE AUTOMÃTICO
    # ========================================
    - name: "EVIDENCIA 6: Verificar arranque automÃ¡tico"
      shell: |
        {
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  6. CONFIGURACIÃ“N DE ARRANQUE AUTOMÃTICO"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "--- Servicios habilitados en el arranque ---"
        systemctl list-unit-files --type=service --state=enabled --no-pager | head -30
        echo ""
        echo "--- Servicios crÃ­ticos y su estado de arranque ---"
        echo ""
        for service in radvd isc-dhcp-server apache2 vsftpd ssh firewalld; do
          enabled=$(systemctl is-enabled $service 2>/dev/null || echo "N/A")
          echo "  $service: $enabled"
        done
        echo ""
        echo "--- AnÃ¡lisis de tiempos de arranque ---"
        systemd-analyze blame 2>/dev/null | head -20 || echo "systemd-analyze no disponible"
        } > {{ remote_dir }}/06_arranque_automatico.txt

    # ========================================
    # 7. LOGS Y TROUBLESHOOTING
    # ========================================
    - name: "EVIDENCIA 7: AnÃ¡lisis de logs de servicios"
      shell: |
        {
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  7. LOGS Y TROUBLESHOOTING DE SERVICIOS"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "--- Logs de Apache2 (Ãºltimas 20 lÃ­neas) ---"
        journalctl -u apache2 -n 20 --no-pager 2>/dev/null || echo "No hay logs disponibles"
        echo ""
        echo "--- Logs de SSH (Ãºltimas 15 lÃ­neas) ---"
        journalctl -u ssh -n 15 --no-pager 2>/dev/null || echo "No hay logs disponibles"
        echo ""
        echo "--- Logs de RADVD (Ãºltimas 15 lÃ­neas) ---"
        journalctl -u radvd -n 15 --no-pager 2>/dev/null || echo "No hay logs disponibles"
        echo ""
        echo "--- Errores del sistema (Ãºltimas 10 lÃ­neas) ---"
        journalctl -p err -n 10 --no-pager 2>/dev/null || echo "No hay errores registrados"
        } > {{ remote_dir }}/07_logs_servicios.txt

    # ========================================
    # 8. PRIORIDADES Y NICE VALUES
    # ========================================
    - name: "EVIDENCIA 8: AnÃ¡lisis de prioridades de procesos"
      shell: |
        {
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  8. PRIORIDADES DE PROCESOS (NICE VALUES)"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "--- Top 20 procesos con sus prioridades ---"
        ps -eo pid,ni,pri,pcpu,pmem,comm --sort=-pcpu | head -21
        echo ""
        echo "--- ExplicaciÃ³n de columnas ---"
        echo "  PID:  Process ID"
        echo "  NI:   Nice value (-20 a 19, menor = mayor prioridad)"
        echo "  PRI:  Priority (kernel)"
        echo "  %CPU: Uso de CPU"
        echo "  %MEM: Uso de memoria"
        echo "  COMMAND: Nombre del proceso"
        } > {{ remote_dir }}/08_prioridades_procesos.txt

    # ========================================
    # 9. RECURSOS DEL SISTEMA
    # ========================================
    - name: "EVIDENCIA 9: Monitoreo de recursos del sistema"
      shell: |
        {
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  9. RECURSOS DEL SISTEMA"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "--- InformaciÃ³n de CPU ---"
        lscpu | grep -E "CPU\(s\)|Model name|Thread|Core|Socket"
        echo ""
        echo "--- Memoria RAM ---"
        free -h
        echo ""
        echo "--- Swap ---"
        swapon --show 2>/dev/null || echo "Sin swap configurado"
        echo ""
        echo "--- Load Average ---"
        uptime
        echo ""
        echo "--- Procesos en ejecuciÃ³n ---"
        echo "Total: $(ps aux | wc -l) procesos"
        echo ""
        echo "--- Uso de disco ---"
        df -h | grep -v tmpfs
        } > {{ remote_dir }}/09_recursos_sistema.txt

    # ========================================
    # 10. DEPENDENCIAS DE SERVICIOS
    # ========================================
    - name: "EVIDENCIA 10: Ãrbol de dependencias de servicios"
      shell: |
        {
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  10. DEPENDENCIAS DE SERVICIOS"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "--- Dependencias de Apache2 ---"
        systemctl list-dependencies apache2 --no-pager 2>/dev/null | head -30 || echo "No disponible"
        echo ""
        echo "--- Servicios fallidos (si hay alguno) ---"
        systemctl --failed --no-pager
        } > {{ remote_dir }}/10_dependencias_servicios.txt

    # ========================================
    # REPORTE FINAL
    # ========================================
    - name: "Generar reporte final consolidado"
      shell: |
        {
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘   REPORTE FINAL: GESTIÃ“N DE PROCESOS Y SERVICIOS                 â•‘"
        echo "â•‘   Fecha: {{ ansible_date_time.date }} {{ ansible_date_time.time }}                              â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  RESUMEN EJECUTIVO"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "âœ“ Sistema: {{ ansible_distribution }} {{ ansible_distribution_version }}"
        echo "âœ“ Kernel: {{ ansible_kernel }}"
        echo "âœ“ Uptime: $(uptime -p)"
        echo "âœ“ Load Average: $(uptime | awk -F'load average:' '{print $2}')"
        echo ""
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  SERVICIOS CRÃTICOS VALIDADOS"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        for service in radvd isc-dhcp-server apache2 vsftpd ssh firewalld; do
          status=$(systemctl is-active $service 2>/dev/null || echo "inactive")
          enabled=$(systemctl is-enabled $service 2>/dev/null || echo "disabled")
          if [ "$status" = "active" ]; then
            echo "  âœ“ $service: ACTIVO (arranque: $enabled)"
          else
            echo "  âœ— $service: INACTIVO (arranque: $enabled)"
          fi
        done
        echo ""
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  COMPETENCIAS DEMOSTRADAS"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "  âœ“ GestiÃ³n de servicios con systemd"
        echo "  âœ“ Monitoreo de procesos"
        echo "  âœ“ Control de prioridades"
        echo "  âœ“ ConfiguraciÃ³n de arranque automÃ¡tico"
        echo "  âœ“ Troubleshooting"
        echo "  âœ“ OptimizaciÃ³n de recursos"
        echo ""
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  EVIDENCIAS GENERADAS"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "  ğŸ“ {{ remote_dir }}/"
        ls -lh {{ remote_dir }}/ | tail -n +2
        echo ""
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "  CONCLUSIÃ“N"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "  âœ“ Todos los servicios crÃ­ticos estÃ¡n operativos"
        echo "  âœ“ Sistema optimizado y monitoreado"
        echo "  âœ“ Evidencias completas generadas"
        echo "  âœ“ Competencia demostrada exitosamente"
        echo ""
        } > {{ remote_dir }}/REPORTE_FINAL.txt

    # ========================================
    # DESCARGAR TODAS LAS EVIDENCIAS
    # ========================================
    - name: Descargar todas las evidencias a la mÃ¡quina local
      fetch:
        src: "{{ remote_dir }}/{{ item }}"
        dest: "{{ local_dir }}/{{ item }}"
        flat: yes
      loop:
        - 00_INICIO.txt
        - 01_inventario_servicios.txt
        - 02_servicios_criticos.txt
        - 03_top_procesos_cpu.txt
        - 04_top_procesos_memoria.txt
        - 05_control_servicios.txt
        - 06_arranque_automatico.txt
        - 07_logs_servicios.txt
        - 08_prioridades_procesos.txt
        - 09_recursos_sistema.txt
        - 10_dependencias_servicios.txt
        - REPORTE_FINAL.txt

    # ========================================
    # MENSAJE FINAL
    # ========================================
    - name: Mostrar resumen
      debug:
        msg:
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          - "  âœ“ EVIDENCIAS GENERADAS EXITOSAMENTE"
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          - ""
          - "ğŸ“ UbicaciÃ³n local: {{ local_dir }}/"
          - "ğŸ“ UbicaciÃ³n remota: {{ remote_dir }}/"
          - ""
          - "ğŸ“„ Archivos generados: 12"
          - ""
          - "ğŸ¯ PrÃ³ximo paso: Revisar REPORTE_FINAL.txt"
          - ""
          - "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
