---
all:
  children:
    esxi:
      hosts:
        esxi-vmware-host:
          ansible_host: 172.17.25.1
          ansible_connection: local
          vcenter_hostname: 172.17.25.1
          vcenter_username: root
          vcenter_password: "qwe123$"
          vcenter_port: 443
          vcenter_validate_certs: no
          datacenter: ha-datacenter
          datastore: datastore1

    debian_router:
      hosts:
        debian-router:
          # --- Conexión Ansible ---
          # Se conecta por la IP de gestión, que es fija.
          ansible_host: "172.17.25.10"
          ansible_user: ansible
          ansible_connection: ssh
          ansible_ssh_common_args: '-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o ConnectTimeout=5'
          ansible_become: yes
          ansible_become_method: sudo
          ansible_become_flags: '-S'
          ansible_ssh_timeout: 5
          ansible_timeout: 10

          # --- Configuración de VM ---
          vm_name: vm-debian-router
          vm_folder: "/vm"
          cdrom: "[datastore1] debian/debian-12.12.0-amd64-netinst.iso"
          
          # --- Configuración APT ---
          apt_force_ipv4: false  # No forzar IPv4 para APT ya que queremos usar IPv6
          # La VM debe tener 2 interfaces: una en 'VM Network' y otra en 'Red Fernandez'
          networks:
            - name: VM Network
            - name: Red Fernandez

          # --- Interfaz WAN (y Gestión) ---
          # Configuración inicial para permitir la conexión de Ansible
          ansible_initial_ip: "172.17.25.10"  # IP temporal para gestión inicial
          
          # Configuración final de WAN
          wan_method: "dhcp"  # Método de configuración: 'dhcp' o 'static'
          wan_interface: ens224  # Interfaz WAN en el router Debian (actualmente tiene 172.17.25.10)

          # --- Interfaz LAN ---
          # Conectada a "Red Fernandez". Da servicio a las VMs del laboratorio.
          lan_interface: ens192  # Interfaz LAN en el router Debian
          lan_ipv6_address: "2025:db8:220::1"
          lan_ipv6_prefix: 64

          # --- Servicios en la LAN ---
          # radvd y dhcpv6 para la subred 2025:DB8:220::/64
          radvd_prefix: "2025:db8:220::/64"
          dhcpv6_subnet: "2025:db8:220::"
          dhcpv6_prefix: 64
          dhcpv6_range_start: "2025:db8:220::100"
          dhcpv6_range_end: "2025:db8:220::200"
          dhcpv6_dns_servers:
            - "2001:4860:4860::8888"
            - "2001:4860:4860::8844"

    vm_hosts:
      hosts:
        ubuntu-pc:
          ansible_host: "2025:db8:101::10"  # Nueva red unificada
          ansible_user: ansible
          ansible_connection: ssh
          vm_name: vm-ubuntu-pc
          vm_folder: "/vm"
          cdrom: "[datastore1] ubuntu/ubuntu-24.04.2-desktop-amd64.iso"
          networks:
            - name: Red Fernandez
              type: slaac  # Obtiene IP del Debian Router
              ipv6_expected: "2025:db8:101::10"
              ipv6_prefix: "64"

        windows-pc:
          ansible_host: "2025:db8:101::11"  # Nueva red unificada
          ansible_user: Administrator
          ansible_connection: winrm
          ansible_winrm_server_cert_validation: ignore
          ansible_winrm_transport: basic
          vm_name: vm-windows-pc
          vm_folder: "/vm"
          cdrom: "[datastore1] W-11/Win11_24H2_Spanish_x64.iso"
          networks:
            - name: Red Fernandez
              type: slaac  # Obtiene IP del Debian Router
              ipv6_expected: "2025:db8:101::11"
              ipv6_prefix: "64"

    ios_routers:
      hosts:
        ios-core-router:
          ansible_host: "2025:db8:101::1"
          ansible_user: cisco
          ansible_connection: network_cli
          ansible_network_os: ios
          ansible_ssh_common_args: '-o StrictHostKeyChecking=no'
          hostname: CORE-ROUTER-101
          interfaces:
            - name: GigabitEthernet0/0
              description: "Uplink to Backbone"
              ipv6_address: "2025:db8:101::1"
              ipv6_prefix: "64"
            - name: GigabitEthernet0/1
              description: "Link to VMware VLAN 220"
              ipv6_address: "2025:db8:101::a2"
              ipv6_prefix: "64"
              vlan: 220

    ios_switches:
      hosts:
        access-switch:
          ansible_host: "2025:db8:101::2"
          ansible_user: cisco
          ansible_connection: network_cli
          ansible_network_os: ios
          hostname: SW-ACCESS-220
          management_ipv6: "2025:db8:101::2/64"
          management_vlan: 101
          vlan_interfaces:
            - id: 220
              name: "VMware-220"
              ipv6_address: "2025:db8:220::2"
              ipv6_prefix: "64"
          access_ports:
            - port: "GigabitEthernet1/0/1"
              vlan: 220
              description: "VM router uplink"
            - port: "GigabitEthernet1/0/2"
              vlan: 220
              description: "VM hosts"
          trunk_ports:
            - port: "GigabitEthernet1/0/24"
              vlans: [101, 220]
              description: "Trunk to core"
              
    all_vms:
      children:
        vm_router:
        vm_hosts:
        
    all_ios:
      children:
        ios_routers:
        ios_switches: