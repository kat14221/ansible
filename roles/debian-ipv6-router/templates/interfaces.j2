# Configuración de Red - Debian Router
# Generado por Ansible - NO editar manualmente

source /etc/network/interfaces.d/*

# ============================================
# Loopback
# ============================================
auto lo
iface lo inet loopback

# ============================================
# Interfaz WAN (e.g., ens224)
# Conectada a la red externa para salida a Internet.
# - IPv4 por DHCP para obtener IP automáticamente
# - IPv6 por DHCP para conectividad
# ============================================
auto {{ wan_interface }}
iface {{ wan_interface }} inet dhcp
iface {{ wan_interface }} inet6 dhcp

# ============================================
# Interfaz LAN (e.g., ens192)
# Conectada a la red del laboratorio.
# - IPv6 estática para ser el gateway.
# - Aquí operan radvd y dhcpv6.
# ============================================
auto {{ lan_interface }}
iface {{ lan_interface }} inet6 static
    address {{ lan_ipv6_address }}/{{ lan_ipv6_prefix }}
    # No hay gateway en la LAN, este es el gateway.

    # Deshabilitamos la aceptación de Router Advertisements.
    # Este equipo es el router, no un cliente.
    pre-up echo 0 > /proc/sys/net/ipv6/conf/{{ lan_interface }}/accept_ra

    # Habilitamos el forwarding en esta interfaz.
    pre-up echo 1 > /proc/sys/net/ipv6/conf/{{ lan_interface }}/forwarding

    # Rutas estáticas adicionales (opcional)
    # Definir en inventario: static_routes:
    # - network: "2025:db8:100::/64"
    #   via: "2025:db8:101::1"
    #   dev: "{{ lan_interface }}"  # opcional, por defecto lan_interface
    {% if static_routes is defined %}
    {% for r in static_routes %}
    post-up /sbin/ip -6 route add {{ r.network }} via {{ r.via }} dev {{ r.dev | default(lan_interface) }}
    pre-down /sbin/ip -6 route del {{ r.network }} via {{ r.via }} dev {{ r.dev | default(lan_interface) }}
    {% endfor %}
    {% endif %}
