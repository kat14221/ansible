---
# tasks file for academic-users
# Crea los grupos y usuarios para el laboratorio acad√©mico.

# Tareas para sistemas Linux/Unix
- name: Crear grupo para alumnos (Linux)
  group:
    name: alumnos
    state: present
  become: yes
  when: ansible_connection != "winrm"

- name: Crear grupo para profesores (Linux)
  group:
    name: profesores
    state: present
  become: yes
  when: ansible_connection != "winrm"

- name: Crear usuarios alumnos (Linux)
  user:
    name: "{{ item }}"
    password: "{{ 'alumno123' | password_hash('sha512') }}"
    groups: alumnos
    shell: /bin/bash
    state: present
  loop:
    - alumno1
    - alumno2
    - alumno3
  become: yes
  when: ansible_connection != "winrm"

- name: Crear usuarios profesores (Linux)
  user:
    name: "{{ item }}"
    password: "{{ 'profesor123' | password_hash('sha512') }}"
    groups: profesores
    shell: /bin/bash
    state: present
  loop:
    - profesor1  
    - profesor2
  become: yes
  when: ansible_connection != "winrm"

- name: Crear usuario admin con privilegios sudo (Linux)
  user:
    name: admin
    password: "{{ 'admin123' | password_hash('sha512') }}"
    groups: sudo
    shell: /bin/bash
    state: present
  become: yes
  when: ansible_connection != "winrm"

# Tareas para sistemas Windows
- name: Crear usuarios alumnos (Windows)
  win_user:
    name: "{{ item }}"
    password: "alumno123"
    state: present
    password_never_expires: yes
  loop:
    - alumno1
    - alumno2
    - alumno3
  when: ansible_connection == "winrm"

- name: Agregar alumnos al grupo Usuarios (Windows)
  win_group_membership:
    name: Usuarios
    members:
      - alumno1
      - alumno2
      - alumno3
    state: present
  when: ansible_connection == "winrm"
  ignore_errors: yes

- name: Crear usuarios profesores (Windows)
  win_user:
    name: "{{ item }}"
    password: "profesor123"
    state: present
    password_never_expires: yes
  loop:
    - profesor1
    - profesor2
  when: ansible_connection == "winrm"

- name: Agregar profesores al grupo Usuarios (Windows)
  win_group_membership:
    name: Usuarios
    members:
      - profesor1
      - profesor2
    state: present
  when: ansible_connection == "winrm"
  ignore_errors: yes

- name: Crear usuario admin (Windows)
  win_user:
    name: admin
    password: "admin123"
    state: present
    password_never_expires: yes
  when: ansible_connection == "winrm"

- name: Agregar admin al grupo Administradores (Windows)
  win_group_membership:
    name: Administradores
    members:
      - admin
    state: present
  when: ansible_connection == "winrm"
  ignore_errors: yes
